<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>متابعة درجات المتسابقين</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0f172a;
      --panel: #1e293b;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.08);
      --text: #e2e8f0;
      --text-muted: #94a3b8;
      --success: #22c55e;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Tajawal", "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.1), transparent 55%), var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    header h1 {
      font-size: 32px;
    }

    .nav-link {
      padding: 10px 18px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.12);
      color: var(--accent);
      border: 1px solid rgba(56, 189, 248, 0.4);
      font-size: 15px;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .nav-link:hover {
      background: rgba(56, 189, 248, 0.22);
    }

    main {
      display: grid;
      gap: 24px;
    }

    .panel {
      background: linear-gradient(160deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
      border: 1px solid rgba(148, 163, 184, 0.12);
      border-radius: 20px;
      padding: 24px;
      display: grid;
      gap: 24px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.45);
      backdrop-filter: blur(16px);
    }

    .control-group {
      display: grid;
      gap: 12px;
    }

    label {
      font-size: 15px;
      color: var(--text-muted);
    }

    input[type="text"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.6);
      color: var(--text);
      font-size: 16px;
    }

    input[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .add-row {
      display: flex;
      gap: 12px;
    }

    .add-row input {
      flex: 1;
    }

    .add-button {
      padding: 12px 18px;
      border-radius: 12px;
      border: 1px solid rgba(56, 189, 248, 0.5);
      background: rgba(56, 189, 248, 0.18);
      color: var(--accent);
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .add-button:hover {
      background: rgba(56, 189, 248, 0.28);
    }

    .competitor-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .competitor-card {
      padding: 16px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.16);
      background: rgba(15, 23, 42, 0.5);
      display: grid;
      gap: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: right;
    }

    .competitor-card .name {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
    }

    .competitor-card .score {
      font-size: 16px;
      color: var(--accent);
    }

    .competitor-card.active {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.18);
    }

    .empty-state {
      padding: 16px;
      border-radius: 14px;
      border: 1px dashed rgba(148, 163, 184, 0.3);
      color: var(--text-muted);
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 14px;
      overflow: hidden;
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    thead {
      background: rgba(56, 189, 248, 0.08);
    }

    th,
    td {
      padding: 14px 16px;
      text-align: right;
      font-size: 15px;
    }

    tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.35);
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .action-button {
      padding: 8px 16px;
      border-radius: 10px;
      border: 1px solid transparent;
      background: rgba(148, 163, 184, 0.12);
      color: var(--text-muted);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .action-button.bonus {
      border-color: rgba(34, 197, 94, 0.25);
    }

    .action-button.penalty {
      border-color: rgba(239, 68, 68, 0.25);
    }

    .action-button.active {
      color: #0f172a;
      background: var(--accent);
      border-color: var(--accent);
      font-weight: 600;
    }

    .action-button.bonus.active {
      background: rgba(34, 197, 94, 0.9);
      border-color: rgba(34, 197, 94, 0.9);
      color: #04170b;
    }

    .action-button.penalty.active {
      background: rgba(239, 68, 68, 0.9);
      border-color: rgba(239, 68, 68, 0.9);
      color: #2f0303;
    }

    .score-summary {
      display: grid;
      gap: 12px;
      padding: 16px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.18);
    }

    .score-line {
      display: flex;
      justify-content: space-between;
      font-size: 16px;
    }

    .score-line strong {
      color: var(--text);
    }

    .score-line .bonus {
      color: var(--success);
    }

    .score-line .penalty {
      color: var(--danger);
    }

    .competitor-id {
      font-size: 18px;
      color: var(--accent);
      text-align: center;
    }

    @media (max-width: 768px) {
      body {
        padding: 20px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      header h1 {
        font-size: 26px;
      }

      .add-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>إدارة درجات المتسابقين</h1>
    <a class="nav-link" href="index.html">العودة للنظام</a>
  </header>
  <main>
    <section class="panel">
      <div class="control-group add-competitor">
        <label for="newCompetitorName">إضافة متسابق جديد</label>
        <div class="add-row">
          <input type="text" id="newCompetitorName" placeholder="اكتب اسم المتسابق" autocomplete="off">
          <button type="button" class="add-button" id="addCompetitorButton">إضافة</button>
        </div>
      </div>
      <div class="competitor-list" id="competitorList">
        <div class="empty-state">لا يوجد متسابقون بعد</div>
      </div>
      <div class="control-group">
        <label for="competitorName">اسم المتسابق الحالي</label>
        <input type="text" id="competitorName" placeholder="اختر متسابقاً للتعديل" autocomplete="off" disabled>
      </div>
      <table>
        <thead>
          <tr>
            <th>الميزة</th>
            <th>الوصف</th>
            <th>الإجراء</th>
          </tr>
        </thead>
        <tbody id="competitorRows"></tbody>
      </table>
      <div class="score-summary">
        <div class="competitor-id" id="competitorDisplay">لم يتم اختيار متسابق</div>
        <div class="score-line">
          <span>الدرجة الأساسية</span>
          <strong id="baseScore">0</strong>
        </div>
        <div class="score-line">
          <span>إجمالي الزيادات</span>
          <strong class="bonus" id="totalBonus">+0</strong>
        </div>
        <div class="score-line">
          <span>إجمالي الخصومات</span>
          <strong class="penalty" id="totalPenalty">-0</strong>
        </div>
        <div class="score-line">
          <span>الدرجة النهائية</span>
          <strong id="finalScore">0</strong>
        </div>
      </div>
    </section>
  </main>
  <script>
    const scoringSystem = {
      gradeMax: 0,
      features: [
        {
          id: "clarity",
          title: "وضوح الحل",
          description: "تفصيل الخطوات والمنهجية بشكل منظم وسهل الفهم.",
          bonus: 15,
          penalty: 10
        },
        {
          id: "time",
          title: "الالتزام بالوقت",
          description: "تسليم الحلول في المدة المحددة دون تأخير.",
          bonus: 10,
          penalty: 8
        },
        {
          id: "innovation",
          title: "الابتكار",
          description: "إدخال أفكار جديدة أو تحسينات مميزة على الحل.",
          bonus: 20,
          penalty: 12
        },
        {
          id: "quality",
          title: "جودة التنفيذ",
          description: "خلو الحل من الأخطاء وتحقيق النتيجة المطلوبة بدقة.",
          bonus: 18,
          penalty: 14
        }
      ]
    };

    const competitorRows = document.getElementById("competitorRows");
    const competitorList = document.getElementById("competitorList");
    const newCompetitorNameInput = document.getElementById("newCompetitorName");
    const addCompetitorButton = document.getElementById("addCompetitorButton");
    const competitorNameInput = document.getElementById("competitorName");
    const competitorDisplay = document.getElementById("competitorDisplay");
    const baseScoreEl = document.getElementById("baseScore");
    const totalBonusEl = document.getElementById("totalBonus");
    const totalPenaltyEl = document.getElementById("totalPenalty");
    const finalScoreEl = document.getElementById("finalScore");

    const competitors = [];
    let activeCompetitorId = null;

    function createFeatureState() {
      const state = new Map();
      scoringSystem.features.forEach(feature => state.set(feature.id, null));
      return state;
    }

    function calculateTotals(featureState) {
      let bonus = 0;
      let penalty = 0;
      scoringSystem.features.forEach(feature => {
        const state = featureState.get(feature.id);
        if (state === "bonus") {
          bonus += feature.bonus;
        }
        if (state === "penalty") {
          penalty += feature.penalty;
        }
      });
      return { bonus, penalty };
    }

    function calculateFinalScore(competitor) {
      const { bonus, penalty } = calculateTotals(competitor.featureState);
      return scoringSystem.gradeMax + bonus - penalty;
    }

    function renderCompetitorList() {
      competitorList.innerHTML = "";
      if (!competitors.length) {
        const empty = document.createElement("div");
        empty.className = "empty-state";
        empty.textContent = "لا يوجد متسابقون بعد";
        competitorList.appendChild(empty);
        return;
      }
      competitors.forEach(competitor => {
        const card = document.createElement("button");
        card.type = "button";
        card.className = `competitor-card${competitor.id === activeCompetitorId ? " active" : ""}`;
        card.dataset.id = competitor.id;
        card.innerHTML = `
          <span class="name">${competitor.name || "متسابق بدون اسم"}</span>
          <span class="score">${calculateFinalScore(competitor)}</span>
        `;
        competitorList.appendChild(card);
      });
    }

    function updateButtonsForCompetitor(competitor) {
      document.querySelectorAll(".action-button").forEach(button => button.classList.remove("active"));
      if (!competitor) {
        return;
      }
      scoringSystem.features.forEach(feature => {
        const state = competitor.featureState.get(feature.id);
        if (!state) {
          return;
        }
        document.querySelectorAll(`button[data-id="${feature.id}"]`).forEach(button => {
          if (button.dataset.action === state) {
            button.classList.add("active");
          }
        });
      });
    }

    function refreshSummary() {
      const competitor = competitors.find(item => item.id === activeCompetitorId) || null;
      if (!competitor) {
        competitorDisplay.textContent = "لم يتم اختيار متسابق";
        baseScoreEl.textContent = scoringSystem.gradeMax;
        totalBonusEl.textContent = "+0";
        totalPenaltyEl.textContent = "-0";
        finalScoreEl.textContent = scoringSystem.gradeMax;
        competitorNameInput.value = "";
        competitorNameInput.disabled = true;
        updateButtonsForCompetitor(null);
        return;
      }
      competitorDisplay.textContent = `المتسابق: ${competitor.name || "بدون اسم"}`;
      const totals = calculateTotals(competitor.featureState);
      baseScoreEl.textContent = scoringSystem.gradeMax;
      totalBonusEl.textContent = `+${totals.bonus}`;
      totalPenaltyEl.textContent = `-${totals.penalty}`;
      finalScoreEl.textContent = calculateFinalScore(competitor);
      competitorNameInput.disabled = false;
      competitorNameInput.value = competitor.name;
      updateButtonsForCompetitor(competitor);
    }

    function setActiveCompetitor(id) {
      activeCompetitorId = id;
      renderCompetitorList();
      refreshSummary();
    }

    function addCompetitor() {
      const name = newCompetitorNameInput.value.trim();
      if (!name) {
        return;
      }
      const competitor = {
        id: `cmp-${Date.now()}-${Math.random().toString(16).slice(2, 8)}`,
        name,
        featureState: createFeatureState()
      };
      competitors.push(competitor);
      newCompetitorNameInput.value = "";
      setActiveCompetitor(competitor.id);
    }

    function initializeTable() {
      scoringSystem.features.forEach(feature => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${feature.title}</td>
          <td>${feature.description}</td>
          <td class="actions">
            <button class="action-button bonus" data-action="bonus" data-id="${feature.id}">زيادة +${feature.bonus}</button>
            <button class="action-button penalty" data-action="penalty" data-id="${feature.id}">خصم -${feature.penalty}</button>
          </td>
        `;
        competitorRows.appendChild(row);
      });
    }

    function toggleAction(button) {
      const competitor = competitors.find(item => item.id === activeCompetitorId);
      if (!competitor) {
        return;
      }
      const id = button.dataset.id;
      const action = button.dataset.action;
      const currentState = competitor.featureState.get(id);
      const isActive = currentState === action;
      competitor.featureState.set(id, isActive ? null : action);
      updateButtonsForCompetitor(competitor);
      refreshSummary();
      renderCompetitorList();
    }

    addCompetitorButton.addEventListener("click", addCompetitor);

    newCompetitorNameInput.addEventListener("keydown", event => {
      if (event.key === "Enter") {
        event.preventDefault();
        addCompetitor();
      }
    });

    competitorList.addEventListener("click", event => {
      const card = event.target.closest(".competitor-card");
      if (!card) {
        return;
      }
      setActiveCompetitor(card.dataset.id);
    });

    competitorNameInput.addEventListener("input", event => {
      const competitor = competitors.find(item => item.id === activeCompetitorId);
      if (!competitor) {
        return;
      }
      competitor.name = event.target.value.trim();
      renderCompetitorList();
      refreshSummary();
    });

    document.addEventListener("click", event => {
      const target = event.target;
      if (target.classList && target.classList.contains("action-button")) {
        toggleAction(target);
      }
    });

    baseScoreEl.textContent = scoringSystem.gradeMax;
    initializeTable();
    refreshSummary();
  </script>
</body>
</html>
